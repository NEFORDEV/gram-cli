"""–°–æ–∑–¥–∞–Ω–∏–µ FastAPI –ø—Ä–æ–µ–∫—Ç–æ–≤"""
from pathlib import Path
from rich.console import Console
from rich.panel import Panel

console = Console()

def create_project(project_name: str):
    """–°–æ–∑–¥–∞–µ—Ç FastAPI –ø—Ä–æ–µ–∫—Ç"""
    project_name = project_name.lower()
    
    if project_name != "fastapi":
        error_panel = Panel(
            "[red bold]‚ùå –û—à–∏–±–∫–∞: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 'fastapi'![/red bold]\n\n"
            "[yellow]–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã:[/yellow]\n"
            "[bold]fastapi[/bold] - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ üöÄ",
            title="üö´ –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø—Ä–æ–µ–∫—Ç",
            border_style="red"
        )
        console.print(error_panel)
        return

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç –≤ –ø–∞–ø–∫–µ fastapi_project
    cwd = Path.cwd()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if any(cwd.iterdir()):
        # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ –ø—É—Å—Ç–∞, —Å–æ–∑–¥–∞–µ–º fastapi_project
        base_path = cwd / "fastapi_project"
    else:
        # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, —Å–æ–∑–¥–∞–µ–º fastapi_project –ø—Ä—è–º–æ –≤ –Ω–µ–π
        base_path = cwd / "fastapi_project"

    console.print(f"\n[bold cyan]üî® üöÄ –°–æ–∑–¥–∞—é FastAPI –ø—Ä–æ–µ–∫—Ç –≤ –ø–∞–ø–∫–µ 'fastapi_project'...[/bold cyan]\n")
    
    # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –¥–ª—è FastAPI (–≤–Ω—É—Ç—Ä–∏ fastapi_project/backend/)
    folders = [
        "backend",
        "backend/docs",
        "backend/app",
        "backend/app/database",
        "backend/app/schema", 
        "backend/app/routers",
        "backend/app/broker",
        "backend/app/functions"
    ]

    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
    for i, folder in enumerate(folders, 1):
        folder_path = base_path / folder
        folder_path.mkdir(parents=True, exist_ok=True)
        console.print(f"[dim]  {i:2d}/{len(folders)}[/dim] üìÅ [bold green]–°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞:[/bold green] {folder}")

    # –°–æ–∑–¥–∞–µ–º init —Ñ–∞–π–ª—ã
    init_files = [
        "backend/__init__.py",
        "backend/app/database/__init__.py",
        "backend/app/schema/__init__.py",
        "backend/app/routers/__init__.py",
        "backend/app/broker/__init__.py",
        "backend/app/functions/__init__.py"
    ]

    for i, file_path in enumerate(init_files, 1):
        full_path = base_path / file_path
        full_path.touch(exist_ok=True)
        console.print(f"[dim]  {i:2d}/{len(init_files)}[/dim] üìÑ [bold blue]–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:[/bold blue] {file_path}")

    # –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
    main_files = [
        ("backend/app/main.py", "# FastAPI main application\nfrom fastapi import FastAPI\n\napp = FastAPI()\n"),
        ("backend/docs/README.md", "# FastAPI Project\n\nGenerated by GRAM CLI üöÄ\n")
    ]

    for file_path, content in main_files:
        full_path = base_path / file_path
        full_path.write_text(content, encoding="utf-8")
        console.print(f"[dim]      [/dim] ‚ú® [bold yellow]–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:[/bold yellow] {file_path}")

    # –ü–∞–Ω–µ–ª—å —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
    success_panel = Panel(
        f"[bold bright_green]üéâ FastAPI –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω![/bold bright_green]\n"
        f"[cyan]üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:[/cyan] [yellow]{base_path}[/yellow]\n"
        f"[cyan]üèóÔ∏è  –°–æ–∑–¥–∞–Ω–æ:[/cyan] [green]{len(folders)} –ø–∞–ø–æ–∫[/green], [blue]{len(init_files)} —Ñ–∞–π–ª–æ–≤[/blue]",
        title="üöÄ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤!",
        border_style="bright_green"
    )
    console.print("\n")
    console.print(success_panel)
    console.print(f"\n[dim]üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –ø–∞–ø–∫–µ fastapi_project/backend. –ü–µ—Ä–µ–π–¥–∏—Ç–µ —Ç—É–¥–∞ –∏ –Ω–∞—á–Ω–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É![/dim]\n")